<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Styles for header, main, and form */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        header {
            background-color: #333;
            color: #fff;
            padding: 20px;
            text-align: center;
        }

        main {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            text-align: center;
        }

        form {
            margin-top: 20px;
            text-align: center;
        }

        label {
            display: block;
            margin-bottom: 6px;
        }

        input[type="number"], input[type="text"], button {
            padding: 10px;
            margin-bottom: 10px;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background-color: #333;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #555;
        }

        .result {
            margin-top: 20px;
            font-size: 18px;
        }

        /* New styles for reset button */
        .reset-btn {
            background-color: #f44336;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }

        .reset-btn:hover {
            background-color: #d32f2f;
        }

        /* New styles for error message */
        .error {
            color: #f44336;
            font-size: 14px;
            margin-top: 10px;
        }

        /* New styles for chart container */
        .chart-container {
            margin-top: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>Finance Calculator</h1>
    </header>
    <main>
        <section>
            <h2>Calculate financial metrics such as internal rate of return (IRR), net present value (NPV), etc.</h2>
            <!-- Error message -->
            <p id="error" class="error"></p>
            <!-- Form -->
            <form id="financeForm">
                <label for="cashFlows">Cash Flows (Comma-separated)</label>
                <input type="text" id="cashFlows" placeholder="Enter cash flows" required>
                <label for="rate">Interest Rate (%)</label>
                <input type="number" id="rate" placeholder="Enter interest rate" min="0" step="0.01" required>
                <button type="button" onclick="calculateFinance()">Calculate</button>
            </form>
            <!-- Result -->
            <div id="financeResult" class="result"></div>
            <!-- Reset button -->
            <button class="reset-btn" onclick="resetFinanceForm()">Reset</button>
        </section>
        <!-- Chart container -->
        <section class="chart-container">
            <canvas id="financeChart"></canvas>
        </section>
        <!-- Information section -->
        <section class="info-section">
            <h3>About Finance Calculator</h3>
            <p>
                The Finance Calculator helps you calculate financial metrics such as internal rate of return (IRR), 
                net present value (NPV), etc. Enter the cash flows separated by commas and the interest rate, then 
                click "Calculate" to get the results. The chart below visualizes the cash flows.
            </p>
        </section>
    </main>
    <script>
        const ctx = document.getElementById('financeChart').getContext('2d');
        let financeChart;

        function calculateFinance() {
            const cashFlows = document.getElementById('cashFlows').value.split(',').map(Number);
            const rate = parseFloat(document.getElementById('rate').value);

            // Check if any of the inputs are NaN
            if (isNaN(rate) || cashFlows.some(isNaN)) {
                document.getElementById('error').innerHTML = 'Please enter valid numbers for all fields.';
                return;
            }

            // Clear previous result
            document.getElementById('financeResult').innerHTML = '';

            // Calculate Net Present Value (NPV)
            const npv = calculateNPV(cashFlows, rate);

            // Calculate Internal Rate of Return (IRR)
            const irr = calculateIRR(cashFlows);

            // Display results
            document.getElementById('financeResult').innerHTML = `
                <p>Net Present Value (NPV): â‚¹${npv.toFixed(2)}</p>
                <p>Internal Rate of Return (IRR): ${(irr * 100).toFixed(2)}%</p>
            `;

            // Update chart
            if (financeChart) {
                financeChart.destroy();
            }
            financeChart = generateChart(cashFlows);
        }

        function calculateNPV(cashFlows, rate) {
            return cashFlows.reduce((acc, cf, i) => acc + (cf / Math.pow(1 + rate / 100, i)), 0);
        }

        function calculateIRR(cashFlows) {
            // Define a function to calculate the NPV with a given rate
            const calculateNPVWithRate = rate => calculateNPV(cashFlows, rate);

            // Use a root-finding algorithm (Newton's method) to find the rate that makes NPV zero
            const irr = newtonRaphson(calculateNPVWithRate, 0.1);

            return irr;
        }

        function newtonRaphson(f, guess, tolerance = 1e-5, maxIterations = 100) {
            let x0 = guess;
            let x1 = guess;

            for (let i = 0; i < maxIterations; i++) {
                const f0 = f(x0);
                const f1 = (f(x0 + tolerance) - f0) / tolerance;

                x1 = x0 - f0 / f1;

                if (Math.abs(x1 - x0) < tolerance) {
                    return x1;
                }

                x0 = x1;
            }

            return x1;
        }

        function resetFinanceForm() {
            document.getElementById('financeForm').reset();
            document.getElementById('error').innerHTML = '';
            document.getElementById('financeResult').innerHTML = '';

            // Destroy the chart if it exists
            if (financeChart) {
                financeChart.destroy();
            }
        }

        function generateChart(cashFlows) {
            const data = {
                labels: cashFlows.map((_, i) => `Year ${i + 1}`),
                datasets: [{
                    label: 'Cash Flows',
                    data: cashFlows,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            };

            const options = {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            };

            return new Chart(ctx, {
                type: 'bar',
                data: data,
                options: options
            });
        }
    </script>
</body>
</html>
